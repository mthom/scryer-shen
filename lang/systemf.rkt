#lang racket

(provide reserved-shen-symbols
         reserved-shen-symbol?
         systemf)

(define system-symbols (make-hasheq '((! . 'external)
                                      (|}| . 'external)
                                      (|{| . 'external)
                                      (--> . 'external)
                                      (<-- . 'external)
                                      (&& . 'external)
                                      (: . 'internal)
                                      (|;| . 'internal)
                                      (:= . 'internal)
                                      (|,| . 'internal)
                                      (|_| . 'external)
                                      (*language* . 'external)
                                      (*implementation* . 'external)
                                      (*stinput* . 'external)
                                      (*sterror* . 'external)
                                      (*stoutput* . 'external)
                                      (*home-directory* . 'external)
                                      (*version* . 'external)
                                      (*maximum-print-sequence-size* . 'external)
                                      (*macros* . 'external)
                                      (*os* . 'external)
                                      (*release* . 'external)
                                      (*property-vector* . 'external)
                                      (/. . 'external)
                                      (@v . 'external)
                                      (@p . 'external)
                                      (@s . 'external)
                                      (*port* . 'external)
                                      (*porters* . 'external)
                                      (*hush* . 'external)
                                      (<- . 'external)
                                      (-> . 'external)
                                      (<e> . 'external)
                                      (== . 'external)
                                      (= . 'external)
                                      (>= . 'external)
                                      (> . 'external)
                                      (==> . 'external)
                                      (<!> . 'external)
                                      (<end> . 'external)
                                      ($ . 'external)
                                      (- . 'external)
                                      (/ . 'external)
                                      (* . 'external)
                                      (+ . 'external)
                                      (<= . 'external)
                                      (< . 'external)
                                      (>> . 'external)
                                      (<> . 'external)
                                      (y-or-n? . 'external)
                                      (write-to-file . 'external)
                                      (write-byte . 'external)
                                      (where . 'external)
                                      (when . 'external)
                                      (warn . 'external)
                                      (version . 'external)
                                      (verified . 'external)
                                      (variable? . 'external)
                                      (var? . 'external)
                                      (value . 'external)
                                      (vector-> . 'external)
                                      (<-vector . 'external)
                                      (vector . 'external)
                                      (vector? . 'external)
                                      (u! . 'external)
                                      (update-lambda-table . 'external)
                                      (unspecialise . 'external)
                                      (untrack . 'external)
                                      (unit . 'external)
                                      (unix . 'external)
                                      (union . 'external)
                                      (unput . 'external)
                                      (unprofile . 'external)
                                      (undefmacro . 'external)
                                      (return . 'external)
                                      (type . 'external)
                                      (tuple? . 'external)
                                      (true . 'external)
                                      (trap-error . 'external)
                                      (track . 'external)
                                      (time . 'external)
                                      (thaw . 'external)
                                      (tc? . 'external)
                                      (tc . 'external)
                                      (tl . 'external)
                                      (tlstr . 'external)
                                      (tlv . 'external)
                                      (tail . 'external)
                                      (systemf . 'external)
                                      (synonyms . 'external)
                                      (symbol . 'external)
                                      (symbol? . 'external)
                                      (string->symbol . 'external)
                                      (sum . 'external)
                                      (subst . 'external)
                                      (string? . 'external)
                                      (string->n . 'external)
                                      (stream . 'external)
                                      (string . 'external)
                                      (stinput . 'external)
                                      (sterror . 'external)
                                      (stoutput . 'external)
                                      (step . 'external)
                                      (spy . 'external)
                                      (specialise . 'external)
                                      (snd . 'external)
                                      (simple-error . 'external)
                                      (set . 'external)
                                      (save . 'external)
                                      (str . 'external)
                                      (run . 'external)
                                      (reverse . 'external)
                                      (retract . 'external)
                                      (remove . 'external)
                                      (release . 'external)
                                      (read . 'external)
                                      (receive . 'external)
                                      (read-file . 'external)
                                      (read-file-as-bytelist . 'external)
                                      (read-file-as-string . 'external)
                                      (read-byte . 'external)
                                      (read-from-string . 'external)
                                      (read-from-string-unprocessed . 'external)
                                      (package? . 'external)
                                      (put . 'external)
                                      (preclude . 'external)
                                      (preclude-all-but . 'external)
                                      (ps . 'external)
                                      (prolog? . 'external)
                                      (protect . 'external)
                                      (profile-results . 'external)
                                      (profile . 'external)
                                      (prolog-memory . 'external)
                                      (print . 'external)
                                      (pprint . 'external)
                                      (pr . 'external)
                                      (pos . 'external)
                                      (porters . 'external)
                                      (port . 'external)
                                      (package . 'external)
                                      (output . 'external)
                                      (out . 'external)
                                      (os . 'external)
                                      (or . 'external)
                                      (optimise . 'external)
                                      (open . 'external)
                                      (occurrences . 'external)
                                      (occurs-check . 'external)
                                      (n->string . 'external)
                                      (number? . 'external)
                                      (number . 'external)
                                      (null . 'external)
                                      (nth . 'external)
                                      (not . 'external)
                                      (nl . 'external)
                                      (mode . 'external)
                                      (macroexpand . 'external)
                                      (maxinferences . 'external)
                                      (mapcan . 'external)
                                      (map . 'external)
                                      (make-string . 'external)
                                      (load . 'external)
                                      (loaded . 'external)
                                      (list . 'external)
                                      (lineread . 'external)
                                      (limit . 'external)
                                      (length . 'external)
                                      (let . 'external)
                                      (lazy . 'external)
                                      (lambda . 'external)
                                      (language . 'external)
                                      (is . 'external)
                                      (intersection . 'external)
                                      (inferences . 'external)
                                      (intern . 'external)
                                      (integer? . 'external)
                                      (input . 'external)
                                      (input . 'external)
                                      (inline . 'external)
                                      (include . 'external)
                                      (include-all-but . 'external)
                                      (it . 'external)
                                      (is . 'external)
                                      (is! . 'external)
                                      (in . 'external)
                                      (in-package . 'external)
                                      (internal . 'external)
                                      (implementation . 'external)
                                      (if . 'external)
                                      (head . 'external)
                                      (hd . 'external)
                                      (hdv . 'external)
                                      (hdstr . 'external)
                                      (hash . 'external)
                                      (get . 'external)
                                      (get-time . 'external)
                                      (gensym . 'external)
                                      (fn . 'external)
                                      (function . 'external)
                                      (fst . 'external)
                                      (freeze . 'external)
                                      (fresh . 'external)
                                      (fork . 'external)
                                      (foreign . 'external)
                                      (fix . 'external)
                                      (file . 'external)
                                      (fail . 'external)
                                      (fail-if . 'external)
                                      (factorise . 'external)
                                      (findall . 'external)
                                      (false . 'external)
                                      (enable-type-theory . 'external)
                                      (explode . 'external)
                                      (external . 'external)
                                      (exception . 'external)
                                      (eval-kl . 'external)
                                      (eval . 'external)
                                      (error-to-string . 'external)
                                      (error . 'external)
                                      (empty? . 'external)
                                      (element? . 'external)
                                      (do . 'external)
                                      (difference . 'external)
                                      (destroy . 'external)
                                      (defun . 'external)
                                      (define . 'external)
                                      (defmacro . 'external)
                                      (defcc . 'external)
                                      (defprolog . 'external)
                                      (declare . 'external)
                                      (datatype . 'external)
                                      (cn . 'external)
                                      (cons? . 'external)
                                      (cons . 'external)
                                      (cond . 'external)
                                      (concat . 'external)
                                      (compile . 'external)
                                      (cd . 'external)
                                      (cases . 'external)
                                      (call . 'external)
                                      (close . 'external)
                                      (bind . 'external)
                                      (bound? . 'external)
                                      (boolean? . 'external)
                                      (boolean . 'external)
                                      (bootstrap . 'external)
                                      (|.| . 'internal)
                                      (intern . 'external)
                                      (bar! . 'external)
                                      (atom? . 'external)
                                      (asserta . 'external)
                                      (assertz . 'external)
                                      (assoc . 'external)
                                      (arity . 'external)
                                      (append . 'external)
                                      (and . 'external)
                                      (adjoin . 'external)
                                      (<-address . 'external)
                                      (address-> . 'external)
                                      (absvector? . 'external)
                                      (absvector . 'external)
                                      (abort . 'external))))

(define (reserved-shen-symbol? name)
  (if (symbol? name)
      (eq? (cdr (hash-ref system-symbols name (thunk #f))) 'external)
      (error "reserved-shen-symbol?: first parameter must be a symbol.")))

(define (reserved-shen-symbols)
  (map car (hash->list system-symbols)))

(define (systemf name)
  (if (symbol? name)
      (begin
        (hash-set! system-symbols name 'external)
        (filter-map (lambda (pair)
                      (and (eq? (cdr pair) 'external)
                           (car pair)))
                    (hash->list system-symbols)))
      (error "systemf: first parameter must be a symbol.")))
